# üöÄ RealEstateBot: Telegram-–±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏

![Python](https://img.shields.io/badge/Python-3.13-3776AB?logo=python&logoColor=white) 
![aiogram](https://img.shields.io/badge/aiogram-3-2496ED?logo=telegram&logoColor=white) 
![PostgreSQL](https://img.shields.io/badge/PostgreSQL-4169E1?logo=postgresql&logoColor=white) 
![Docker](https://img.shields.io/badge/Docker-2496ED?logo=docker&logoColor=white) 
![GitHub Actions](https://img.shields.io/badge/CI%2FCD-GitHub_Actions-2088FF?logo=githubactions&logoColor=white)

**RealEstateBot** ‚Äî —ç—Ç–æ –º–Ω–æ–≥–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ–∏—Å–∫–∞, –ø—Ä–æ–¥–∞–∂–∏ –∏ –∞—Ä–µ–Ω–¥—ã –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ –≤ –¢—É—Ä—Ü–∏–∏. –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –º–æ—â–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º. –ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —á–∞—Å—Ç–µ–π: —Å–∞–º–æ–≥–æ –±–æ—Ç–∞ (`BotApp`) –∏ —Å—Ç–µ–∫–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –µ–≥–æ —Ä–∞–±–æ—Ç—ã (`MonitoringStack`).

---

## üìÑ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1.  [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
2.  [–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª](#-—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª)
    *   [–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π](#-–¥–ª—è-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
    *   [–î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤](#-–¥–ª—è-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤)
3.  [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#-—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
4.  [–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞ (`BotApp`)](#-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-–±–æ—Ç–∞-botapp)
    *   [–õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (User Flow)](#-–ª–æ–≥–∏–∫–∞-—Ä–∞–±–æ—Ç—ã-user-flow)
    *   [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
    *   [CI/CD –∏ –¥–µ–ø–ª–æ–π](#-cicd-–∏-–¥–µ–ø–ª–æ–π)
    *   [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö](#-—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–±–∞–∑—ã-–¥–∞–Ω–Ω—ã—Ö)
    *   [–û–±–∑–æ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (Handlers)](#-–æ–±–∑–æ—Ä-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤-handlers)
5.  [–°—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (`MonitoringStack`)](#-—Å—Ç–µ–∫-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞-monitoringstack)
    *   [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞)
    *   [–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ CI/CD](#-—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ-–∏-cicd)

---

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö Docker Compose-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ–º—ã—Ö –Ω–∞ –æ–¥–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ. `BotApp` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å—é –ª–æ–≥–∏–∫—É –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º, –≤ —Ç–æ –≤—Ä–µ–º—è –∫–∞–∫ `MonitoringStack` —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏.

```mermaid
graph LR
    %% === 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –¥–ª—è —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã ===
    classDef userStyle fill:#00b4d8,stroke:#90e0ef,stroke-width:2px,color:#fff
    classDef appStyle fill:#007f5f,stroke:#70e000,stroke-width:1px,color:#fff
    classDef dbStyle fill:#5e548e,stroke:#9f86c0,stroke-width:2px,color:#fff
    classDef grafanaStyle fill:#f9844a,stroke:#e0e0e0,stroke-width:1px,color:#fff
    classDef prometheusStyle fill:#e6522c,stroke:#e0e0e0,stroke-width:1px,color:#fff
    classDef lokiStyle fill:#f37121,stroke:#e0e0e0,stroke-width:1px,color:#fff
    classDef agentStyle fill:#fca311,stroke:#e0e0e0,stroke-width:1px,color:#fff
    classDef hidden fill:transparent,stroke:transparent,color:transparent

    %% === 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–ª–æ–∫–æ–≤ (subgraphs) ===
    subgraph "–ö–ª–∏–µ–Ω—Ç"
        U["üì± –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Telegram"]
    end

    subgraph "–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –Ω–∞ –°–µ—Ä–≤–µ—Ä–µ"
        direction TB

        subgraph "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | BotApp"
            direction LR
            BA["ü§ñ Bot: Python/aiogram"]
            DB[("üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: PostgreSQL")]
        end

        subgraph "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ | MonitoringStack"
            subgraph "–°–±–æ—Ä—â–∏–∫–∏ (–ê–≥–µ–Ω—Ç—ã)"
                direction TB
                PA["üõ∞Ô∏è Promtail"]
            end
            
            subgraph "–•—Ä–∞–Ω–∏–ª–∏—â–∞"
                L["üìã Loki"]
                P["üìà Prometheus"]
                L ~~~ P
            end
            
            G["üìä Grafana"]
        end
    end

    %% === 3. –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Å–≤—è–∑–∏ ===
    U -- "TCP/HTTPS - Telegram Bot API" --> BA
    BA <-->|ORM Peewee| DB

    %% –ü–æ—Ç–æ–∫ –ª–æ–≥–æ–≤
    BA -.->|–õ–æ–≥–∏| PA
    DB -.->|–õ–æ–≥–∏| PA
    PA --> L

    %% –ü–æ—Ç–æ–∫ –º–µ—Ç—Ä–∏–∫

    
    %% –ü–æ—Ç–æ–∫ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏
    G -- "–ó–∞–ø—Ä–æ—Å—ã PromQL" --> P
    G -- "–ó–∞–ø—Ä–æ—Å—ã LogQL" --> L

    %% === 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π –∫ —É–∑–ª–∞–º ===
    class U userStyle
    class BA appStyle
    class DB dbStyle
    class G grafanaStyle
    class P prometheusStyle
    class L lokiStyle
    class PA agentStyle

    %% === 5. –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–µ–π ===
    linkStyle 0 stroke:#00b4d8,stroke-width:2px,color:#fff
    linkStyle 1 stroke:#a999c7,stroke-width:2px,stroke-dasharray:5 5,color:#fff
    linkStyle 2,3 stroke:#f37121,stroke-width:2px,stroke-dasharray:3 3,color:#fff
    linkStyle 4,5 stroke:#f37121,stroke-width:2px,color:#fff
    linkStyle 6,7 stroke:#ccc,stroke-width:2px,stroke-dasharray:3 3,color:#fff
```

---

## ‚ú® –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

### üë§ –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
*   **–ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ, –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –∏ —Ç—É—Ä–µ—Ü–∫–æ–≥–æ —è–∑—ã–∫–æ–≤.
*   **–ì–∏–±–∫–∏–π –ø–æ–∏—Å–∫ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏**:
    *   –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤.
    *   –î–µ—Ç–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤: —Ç–∏–ø —Å–¥–µ–ª–∫–∏ (–∞—Ä–µ–Ω–¥–∞/–ø–æ–∫—É–ø–∫–∞), –≥–æ—Ä–æ–¥, —Ç–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏ (–∂–∏–ª–∞—è, –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è, –∑–µ–º–ª—è), –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—ä–µ–∫—Ç–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç, —Ç–∏–ø –¥–æ–º–∞), —Ü–µ–Ω–∞, –ø–ª–æ—â–∞–¥—å, —Ä–∞–π–æ–Ω.
*   **–ü—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π**: –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è–º–∏, –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É.
*   **"–ò–∑–±—Ä–∞–Ω–Ω–æ–µ"**: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –ø–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞.
*   **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –∏ —É–¥–∞–ª—è—Ç—å —Å–≤–æ–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.
*   **–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏**:
    *   –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.
    *   –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –ø—Ä–æ–¥–∞–≤—Ü–∞.
    *   –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –æ–±—ä—è–≤–ª–µ–Ω–∏–µ–º —Å –¥—Ä—É–≥–æ–º —á–µ—Ä–µ–∑ Telegram.

### üëë –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤:
*   **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å**: –î–æ—Å—Ç—É–ø –∫ –ø–∞–Ω–µ–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥—É `/admin`.
*   **–ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏–π**:
    *   –ü—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏–π, –æ–∂–∏–¥–∞—é—â–∏—Ö –º–æ–¥–µ—Ä–∞—Ü–∏–∏, –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–º —á–∞—Ç–µ.
    *   –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–¥–æ–±—Ä–∏—Ç—å (–æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å) –∏–ª–∏ –æ—Ç–∫–ª–æ–Ω–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –Ω–∞–∂–∞—Ç–∏–µ–º –æ–¥–Ω–æ–π –∫–Ω–æ–ø–∫–∏.
    *   –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ —Ä–µ—à–µ–Ω–∏–∏ –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞.
*   **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏**: –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π (–∞–∫—Ç–∏–≤–Ω—ã—Ö, —Å–∫—Ä—ã—Ç—ã—Ö, –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏) —Å —É–¥–æ–±–Ω–æ–π –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π.
*   **–ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞**: –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–≤–∫–ª—é—á–∞—è —Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ, —Ç–µ–∫—Å—Ç) –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–æ—Ç–∞.
*   **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**: –ü—Ä–æ—Å–º–æ—Ç—Ä –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (–æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º).

---

## üõ†Ô∏è –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –û–ø–∏—Å–∞–Ω–∏–µ |
| :--- | :--- | :--- |
| **–ë–æ—Ç (`BotApp`)** | **Python 3.13** | –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è. |
| | **aiogram 3** | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram-–±–æ—Ç–æ–≤. |
| | **Peewee** | –ü—Ä–æ—Å—Ç–æ–π –∏ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π ORM –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö. |
| | **PostgreSQL** | –ù–∞–¥–µ–∂–Ω–∞—è —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. |
| | **Pydantic** | –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. |
| | **Docker** | –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ª–µ–≥–∫–æ–≥–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è. |
| **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (`MonitoringStack`)** | **Prometheus** | –°–±–æ—Ä –∏ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –º–µ—Ç—Ä–∏–∫ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏. |
| | **Loki** | –°–∏—Å—Ç–µ–º–∞ –¥–ª—è —Å–±–æ—Ä–∞ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ª–æ–≥–æ–≤. |
| | **Grafana** | –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ –∏ –ª–æ–≥–æ–≤ –≤ –≤–∏–¥–µ –¥–∞—à–±–æ—Ä–¥–æ–≤. |
| | **Promtail, cAdvisor, Node Exporter** | –ê–≥–µ–Ω—Ç—ã –¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤ –∏ –º–µ—Ç—Ä–∏–∫ —Å Docker –∏ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã. |
| **CI/CD** | **GitHub Actions** | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –æ–±–æ–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–∏ push –≤ `main`. |

---

## ü§ñ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±–æ—Ç–∞ (`BotApp`)

### üìà –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (User Flow)

–û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–æ—Ç–æ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ –º–∞—à–∏–Ω—ã —Å–æ—Å—Ç–æ—è–Ω–∏–π (FSM).

```mermaid
graph TD
    %% === 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –¥–ª—è —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã (–ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ===
    classDef startStyle fill:#00b4d8,stroke:#90e0ef,stroke-width:2px,color:#fff
    classDef menuStyle fill:#1a936f,stroke:#70e000,stroke-width:2px,color:#fff,font-size:16px,font-weight:bold
    classDef fsmStyle fill:#5e548e,stroke:#9f86c0,stroke-width:1px,color:#fff
    classDef dbOpStyle fill:#fca311,stroke:#e0e0e0,stroke-width:1px,color:#212121,font-weight:bold
    classDef dbStyle fill:#3d34a5,stroke:#c9ada7,stroke-width:2px,color:#fff
    classDef resultStyle fill:#007f5f,stroke:#9ef01a,stroke-width:1px,color:#fff
    classDef finalStyle fill:#43aa8b,stroke:#b5e48c,stroke-width:1px,color:#fff
    classDef buttonStyle fill:#3a5a40,stroke:#a3b18a,stroke-width:1px,color:#fff
    classDef LinkStyle fill:#219ebc,stroke:#a3b18a,stroke-width:1px,color:#fff

    %% === 2. –û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫ –∏ –º–µ–Ω—é ===
    Start((üöÄ /start)) --> MainMenu{üèõÔ∏è –ì–õ–ê–í–ù–û–ï –ú–ï–ù–Æ}
    
    %% –ë–ª–æ–∫–∏, –≤–µ–¥—É—â–∏–µ –∫ –ø–æ–∏—Å–∫—É
    B1["üß≠ –ü–æ–∏—Å–∫ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤"]:::buttonStyle
    B2["üîç –ù–∞—á–∞—Ç—å –ø–æ–∏—Å–∫ (–ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º)"]:::buttonStyle
    B5["üìÇ –ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è"]:::buttonStyle
    B6["‚≠ê –ò–∑–±—Ä–∞–Ω–Ω–æ–µ"]:::buttonStyle

    MainMenu --> B1
    MainMenu --> B2
    MainMenu --> B3["üéØ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–∏—Å–∫"]:::buttonStyle
    MainMenu --> B4["‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ"]:::buttonStyle
    MainMenu --> B5
    MainMenu --> B6
    
    %% –ü–æ—Ç–æ–∫–∏ –ø–æ–∏—Å–∫–∞/–ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    subgraph "–ü–æ–∏—Å–∫ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ"
        direction LR
        subgraph "–ü–æ—Ç–æ–∫ –∑–∞–ø—Ä–æ—Å–∞"
            B1 --> QueryGen
            B2 --> QueryGen
            B5 --> QueryGen
            B6 --> QueryGen
        end
        QueryGen["–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –≤ –ë–î"]:::dbOpStyle --> DB[(üóÑÔ∏è PostgreSQL)]:::dbStyle
        DB -->|"–†–µ–∑—É–ª—å—Ç–∞—Ç—ã"| ShowResults["üìä –ü–æ–∫–∞–∑ –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π"]:::resultStyle
    end

    %% === 3. FSM: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞ ===
    subgraph "FSM: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–∏—Å–∫–∞"
        direction TB
        B3 --> FSM_Search_1["1. –í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞"]:::fsmStyle
        FSM_Search_1 --> FSM_Search_2["2. –í—ã–±–æ—Ä —Ü–µ–Ω—ã"]:::fsmStyle
        FSM_Search_2 --> FSM_Search_3["..."]:::fsmStyle
        FSM_Search_3 --> SaveFilters["üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ –ë–î"]:::dbOpStyle
    end
 

    %% === 4. FSM: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è ===
    subgraph "FSM: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è"
        direction TB
        B4 --> FSM_Add_1["1. –í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞"]:::fsmStyle
        FSM_Add_1 --> FSM_Add_2["2. –í–≤–æ–¥ —Ü–µ–Ω—ã"]:::fsmStyle
        FSM_Add_2 --> FSM_Add_3["..."]:::fsmStyle
        FSM_Add_3 -- "–°—Ç–∞—Ç—É—Å: –Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏" --> SaveAd["üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î"]:::dbStyle
        SaveAd --> NotifyAdmin["üì® –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"]:::resultStyle
        NotifyAdmin --> EndAd((‚úÖ –ì–æ—Ç–æ–≤–æ)):::finalStyle
    end

    %% === 5. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π (–¥–ª—è —Ç–µ—Ö, —á—Ç–æ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ —à–∞–≥–µ 2) ===
    class Start startStyle
    class MainMenu menuStyle
```

### üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1.  **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
    ```bash
    git clone https://github.com/your-username/RealEstateBot.git
    cd RealEstateBot/BotApp
    ```

2.  **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
    –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ `BotApp` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –ø—Ä–∏–º–µ—Ä–æ–º –Ω–∏–∂–µ:
    ```env
    # –¢–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ Telegram-–±–æ—Ç–∞
    BOT_TOKEN=12345:ABC-DEF12345

    # –ü–∞—Ä–æ–ª—å –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è postgres –≤ –ë–î
    DB_PASSWORD=your_strong_password
    ```

3.  **–ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker Compose:**
    –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é `docker/` –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
    ```bash
    docker compose up -d --build
    ```
    –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–±–µ—Ä–µ—Ç Docker-–æ–±—Ä–∞–∑, –∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –±–æ—Ç–æ–º –∏ –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö PostgreSQL.

### üîÑ CI/CD –∏ –¥–µ–ø–ª–æ–π

–í –ø—Ä–æ–µ–∫—Ç–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω workflow –¥–ª—è GitHub Actions (`.github/workflows/deploy.yml`), –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

**–î–ª—è —Ä–∞–±–æ—Ç—ã CI/CD –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:**
1.  **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Self-Hosted Runner** –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ, —á—Ç–æ–±—ã GitHub –º–æ–≥ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω–∞ –Ω–µ–º –∫–æ–º–∞–Ω–¥—ã.
2.  **–î–æ–±–∞–≤–∏—Ç—å Secrets –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è GitHub:**
    *   `BOT_TOKEN`: –¢–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞.
    *   `DB_PASSWORD`: –ü–∞—Ä–æ–ª—å –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.

–ü—Ä–∏ –∫–∞–∂–¥–æ–º `push` –≤ –≤–µ—Ç–∫—É `main` GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É, —Å–∫–∞—á–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞, –ø–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç Docker-–æ–±—Ä–∞–∑ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã —Å –±–æ—Ç–æ–º –∏ –ë–î.

### üóÑÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å –ø–æ–º–æ—â—å—é ORM Peewee.

```mermaid
erDiagram
    USERS {
        int id PK
        bigint user_id UK
        varchar username
        varchar language
        varchar city
        int price
    }

    REALTY {
        int id PK
        int user_id FK
        varchar city
        varchar district
        varchar price
        varchar square
        varchar description
        boolean consent_admin
    }

    PHOTOSREALTY {
        int id PK
        int realty_id FK
        varchar file_id UK
    }

    FAVORITES {
        int id PK
        int user_id FK
        int realty_id FK
    }

    APARTMENT_PARAMETERS {
        int id PK
        int user_id FK
        varchar title_parameter
        boolean parameter
    }

    CITY_DISTRICTS {
        int id PK
        varchar city_name
        varchar district
    }

    USERS ||--o{ REALTY : "—Å–æ–∑–¥–∞–µ—Ç"
    USERS ||--o{ FAVORITES : "–¥–æ–±–∞–≤–ª—è–µ—Ç –≤"
    REALTY ||--o{ PHOTOSREALTY : "–∏–º–µ–µ—Ç"
    REALTY ||--o{ FAVORITES : "–¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤"
    USERS ||--o{ APARTMENT_PARAMETERS : "–Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç"
```

### üìÇ –û–±–∑–æ—Ä –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (Handlers)

–í—Å—è –ª–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∞ –Ω–∞ –º–æ–¥—É–ª–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `bot/handlers/`.

#### `main/` - –û—Å–Ω–æ–≤–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ
*   `callbacks.py`: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫–∏ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é: —Å–º–µ–Ω–∞ —è–∑—ã–∫–∞, –ø–µ—Ä–µ—Ö–æ–¥ –≤ "–ú–æ–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è" –∏ "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ", –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é.
*   `messages.py`: –†–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤—É—é –∫–æ–º–∞–Ω–¥—É "üóÇ –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é" –∏–∑ reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.

#### `commands/` - –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥
*   `main.py`: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã:
    *   `/start`: –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å –±–æ—Ç–æ–º, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç deep linking (`/start <ad_id>`) –¥–ª—è –ø–æ–∫–∞–∑–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.
    *   `/admin`: –î–æ—Å—Ç—É–ø –∫ –ø–∞–Ω–µ–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π).
    *   `/add_cities`: –ê–¥–º–∏–Ω-–∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≥–æ—Ä–æ–¥–æ–≤ –∏ —Ä–∞–π–æ–Ω–æ–≤ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
    *   `/rm_me`: –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã —É–¥–∞–ª–∏—Ç—å —Å–≤–æ–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î.
    *   `/id`: –°–ª—É–∂–µ–±–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è ID —á–∞—Ç–∞.
    *   –¢–∞–∫–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç —Ö–µ–Ω–¥–ª–µ—Ä –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è `file_id` –ª—é–±–æ–≥–æ –º–µ–¥–∏–∞—Ñ–∞–π–ª–∞, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ –≤ —á–∞—Ç —Å –±–æ—Ç–æ–º (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤).

#### `add_ads/` - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
–≠—Ç–æ—Ç –º–æ–¥—É–ª—å —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–∞—à–∏–Ω—É —Å–æ—Å—Ç–æ—è–Ω–∏–π (FSM) –¥–ª—è –ø–æ—à–∞–≥–æ–≤–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è.
*   `callbacks.py`: –ó–∞–ø—É—Å–∫–∞–µ—Ç FSM, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞ –∏ —Ç–∏–ø–∞ —Å–¥–µ–ª–∫–∏ (–∞—Ä–µ–Ω–¥–∞/–ø—Ä–æ–¥–∞–∂–∞).
*   `states.py`: –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ FSM. –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ –≤—Å–µ —à–∞–≥–∏: –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–æ–º–Ω–∞—Ç, –≤–≤–æ–¥ —Ü–µ–Ω—ã, –ø–ª–æ—â–∞–¥–∏, —ç—Ç–∞–∂–∞, –æ–ø–∏—Å–∞–Ω–∏—è, –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π (`file_id` —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î) –∏ –≤–≤–æ–¥ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í –∫–æ–Ω—Ü–µ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ–±—ä—è–≤–ª–µ–Ω–∏–µ, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ –ë–î —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "–Ω–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏" –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –∞–¥–º–∏–Ω-—á–∞—Ç.

#### `search_setting/` - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–∏—Å–∫–∞
–ú–æ–¥—É–ª—å —Å FSM –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∏—Å–∫–∞.
*   `callbacks.py`: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ —à–∞–≥–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
    *   –í—ã–±–æ—Ä —Ç–∏–ø–∞ —Å–¥–µ–ª–∫–∏ (–∞—Ä–µ–Ω–¥–∞/–ø–æ–∫—É–ø–∫–∞).
    *   –í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞.
    *   –í—ã–±–æ—Ä –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–Ω–∞—Ç, –Ω–∞–ª–∏—á–∏–µ –º–µ–±–µ–ª–∏ –∏ —Ç.–¥.).
    *   –í—ã–±–æ—Ä —Ü–µ–Ω–æ–≤–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏ –ø–ª–æ—â–∞–¥–∏.
    *   –í—ã–±–æ—Ä —Ä–∞–π–æ–Ω–æ–≤ (—Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –¥–ª—è –≥–æ—Ä–æ–¥–æ–≤ —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —Ä–∞–π–æ–Ω–æ–≤).
    *   –í –∫–æ–Ω—Ü–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–≤–æ–¥–∫—É –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –Ω–∞—á–∞—Ç—å –ø–æ–∏—Å–∫. –í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –ë–î –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

#### `start_search/` - –ü—Ä–æ—Ü–µ—Å—Å –ø–æ–∏—Å–∫–∞ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
*   `callbacks.py`: –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ–∏—Å–∫–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–ª–∏ –±–µ–∑ –Ω–∏—Ö.
    *   –†–µ–∞–ª–∏–∑—É–µ—Ç **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—É—é –ø–∞–≥–∏–Ω–∞—Ü–∏—é**: –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `LIMIT` –∏ `OFFSET` –≤ SQL-–∑–∞–ø—Ä–æ—Å–∞—Ö, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–µ –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Å–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è —Å—Ä–∞–∑—É.
    *   –û–±—ä—è–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è "–ø–∞—á–∫–∞–º–∏" –ø–æ 5 —à—Ç—É–∫. –ö–Ω–æ–ø–∫–∞ "–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë 5 ‚ú®" –ø–æ–¥–≥—Ä—É–∂–∞–µ—Ç —Å–ª–µ–¥—É—é—â—É—é –ø–æ—Ä—Ü–∏—é.
    *   –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è, –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π, –ø–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ.

#### `favorites/` - –†–∞–∑–¥–µ–ª "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ"
*   `callbacks.py`: –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ, —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–π—Ç–∏ –∫ –¥–µ—Ç–∞–ª—å–Ω–æ–º—É –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ª—é–±–æ–≥–æ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏—è.

#### `admin_panel/` - –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
*   `callbacks.py`: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–µ–π—Å—Ç–≤–∏—è –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏:
    *   **–ú–æ–¥–µ—Ä–∞—Ü–∏—è:** –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–æ–∫ "–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å" –∏ "–û—Ç–∫–ª–æ–Ω–∏—Ç—å" –≤ –∞–¥–º–∏–Ω-—á–∞—Ç–µ. –ò–∑–º–µ–Ω—è–µ—Ç —Å—Ç–∞—Ç—É—Å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ –ë–î –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.
    *   **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä—è–≤–ª–µ–Ω–∏—è–º–∏:** –†–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–∫—Ä—ã—Ç—å/–æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –ª—é–±–æ–µ –∏–∑ –Ω–∏—Ö.
*   `states.py`: –°–æ–¥–µ—Ä–∂–∏—Ç FSM –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–∞ **–º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏**. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –±–æ—Ç—É –ø–æ—Å—Ç, –∏ –±–æ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç —Ä–∞—Å—Å—ã–ª–∞—Ç—å –µ–≥–æ –∫–æ–ø–∏—é –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã Telegram.

---

## üñ•Ô∏è –°—Ç–µ–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (`MonitoringStack`)

–≠—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è –Ω–∞–¥ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–µ—Ä–≤–µ—Ä–∞ –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è `BotApp`.

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```mermaid
graph TD
    %% === 1. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∏–ª–µ–π –¥–ª—è —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã ===
    classDef appStyle fill:#007f5f,stroke:#70e000,stroke-width:1.5px,color:#fff
    classDef dbStyle fill:#5e548e,stroke:#9f86c0,stroke-width:1.5px,color:#fff
    classDef vizStyle fill:#f9844a,stroke:#e0e0e0,stroke-width:1.5px,color:#fff
    classDef metricStoreStyle fill:#e6522c,stroke:#e0e0e0,stroke-width:1.5px,color:#fff
    classDef logStoreStyle fill:#f37121,stroke:#e0e0e0,stroke-width:1.5px,color:#fff
    classDef agentStyle fill:#fca311,stroke:#e0e0e0,stroke-width:1.5px,color:#fff,font-weight:bold
    classDef interfaceStyle fill:#219ebc,stroke:#00b4d8,stroke-width:2px,color:#fff

    %% === 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–ª–æ–∫–æ–≤ ===
    subgraph "–•–æ—Å—Ç-–º–∞—à–∏–Ω–∞ (–°–µ—Ä–≤–µ—Ä)"
        D_Sock((‚öôÔ∏è Docker Socket))
        subgraph "–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
            direction LR
            C1[ü§ñ BotApp]
            C2[üóÑÔ∏è PostgreSQL]
        end

        subgraph "–°—Ç–µ–∫ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (Docker)"
            direction TB
            Promtail["üõ∞Ô∏è Promtail"]
            
            subgraph "–•—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–∞–Ω–Ω—ã—Ö"
                direction LR
                Loki["üìã Loki"]
                Prometheus["üìà Prometheus"]
            end
            
            Grafana["üìä Grafana"]
        end
    end
    %% === 3. –ü–æ—Ç–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö ===
    
    %% –ü–æ—Ç–æ–∫ –ª–æ–≥–æ–≤ –æ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∫ Promtail
    C1 -- "stdout/stderr" --> D_Sock
    C2 -- "stdout/stderr" --> D_Sock
    D_Sock -- "–ß–∏—Ç–∞–µ—Ç –ª–æ–≥–∏" --> Promtail
    Promtail -- "–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ª–æ–≥–∏" --> Loki

    %% –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö –≤ Grafana (–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: Grafana –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ)
    Grafana -- "–ó–∞–ø—Ä–æ—Å—ã LogQL" --> Loki
    Grafana -- "–ó–∞–ø—Ä–æ—Å—ã PromQL" --> Prometheus
    
    %% === 4. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π ===
    class C1 appStyle
    class C2 dbStyle
    class Grafana vizStyle
    class Prometheus metricStoreStyle
    class Loki logStoreStyle
    class Promtail agentStyle
    class D_Sock interfaceStyle

    %% === 5. –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è —Å–≤—è–∑–µ–π ===
    linkStyle 0,1,2,3 stroke:#fca311,stroke-width:2px,color:#fff
    linkStyle 4,5 stroke:#fff,stroke-width:2px,stroke-dasharray:5 5,color:#fff
```

### ‚öôÔ∏è –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –°–µ—Ä–≤–∏—Å | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|:---|:---|
| **Grafana** | **–ü–∞–Ω–µ–ª—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏.** –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏ –≤ –≤–∏–¥–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –¥–∞—à–±–æ—Ä–¥–æ–≤. |
| **Prometheus** | **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –º–µ—Ç—Ä–∏–∫.** –°–æ–±–∏—Ä–∞–µ—Ç –∏ —Ö—Ä–∞–Ω–∏—Ç —á–∏—Å–ª–æ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –æ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (—Å–µ—Ä–≤–µ—Ä, –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã). |
| **Loki** | **–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –ª–æ–≥–æ–≤.** –ò–Ω–¥–µ–∫—Å–∏—Ä—É–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ª–æ–≥–æ–≤, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –±—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é. |
| **Promtail** | **–ê–≥–µ–Ω—Ç –¥–ª—è —Å–±–æ—Ä–∞ –ª–æ–≥–æ–≤.** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –ª–æ–≥–∏ –≤ Loki. |
| **cAdvisor** | **–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.** –°–æ–±–∏—Ä–∞–µ—Ç –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É. |
| **Node Exporter** | **–≠–∫—Å–ø–æ—Ä—Ç–µ—Ä –º–µ—Ç—Ä–∏–∫ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω—ã.** –°–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ —Å–∞–º–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ (CPU, –ø–∞–º—è—Ç—å, –¥–∏—Å–∫–∏ –∏ —Ç.–¥.). |

### üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ CI/CD

–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è —Å—Ç–µ–∫–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω `BotApp`:
1.  **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å Self-Hosted Runner** –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.
2.  **–î–æ–±–∞–≤–∏—Ç—å GitHub Secrets** –¥–ª—è —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ Grafana:
    *   `GRAFANA_ADMIN_USER`
    *   `GRAFANA_ADMIN_PASSWORD`
3.  –ü—Ä–∏ `push` –≤ `main` –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `MonitoringStack` —Å—Ä–∞–±–æ—Ç–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π GitHub Actions workflow, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑–≤–µ—Ä–Ω–µ—Ç –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç —Å—Ç–µ–∫ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Grafana –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É `http://<your_server_ip>:3000`.****